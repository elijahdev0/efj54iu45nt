var U=Object.defineProperty;var F=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var B=(e,s,n)=>s in e?U(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,v=(e,s)=>{for(var n in s||(s={}))Q.call(s,n)&&B(e,n,s[n]);if(F)for(var n of F(s))W.call(s,n)&&B(e,n,s[n]);return e};var X=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports);var T=(e,s,n)=>new Promise((l,r)=>{var d=c=>{try{h(n.next(c))}catch(x){r(x)}},a=c=>{try{h(n.throw(c))}catch(x){r(x)}},h=c=>c.done?l(c.value):Promise.resolve(c.value).then(d,a);h((n=n.apply(e,s)).next())});import{c as Z,R as k,E as p,j as t,T as E,I as $,a as J,u as M,C as g,G as f,B as C,A as H,t as R,S,b as j,D as K,d as Y,e as z,f as u,g as N,h as q,i as L,k as V,r as i,l as D,m as ee,n as te,P as se,F as _,o as ne,p as oe,q as ae,L as ce,s as re,v as ie,w as I,x as le,y as de,z as ue,H as he}from"./assets/global.module--4ihqMuE.js";import{S as xe}from"./assets/SchedulesModal-mw9YkjLe.js";var He=X(O=>{var me=Z("hourglass-empty","IconHourglassEmpty",[["path",{d:"M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z",key:"svg-1"}]]);const pe="fs-poster-hEiziAX",we="fs-poster-NxCHQNR",_e="fs-poster-cKuypHd",fe="fs-poster-jXcBsB8",ge="fs-poster-hi5mwv2",be="fs-poster-rl4AQ9-",Se="fs-poster-2075hUr",je="fs-poster-KU5kSZh",ye="fs-poster-9y1jjYh",Pe="fs-poster-UdwWJQV",A={metabox:pe,metabox_title:we,metabox_description:_e,metabox_content:fe,metabox__newChannels:ge,metabox__exist_time:be,logStatus_icon:Se,logStatus_icon__success:je,logStatus_icon__error:ye,logStatus_icon__warning:Pe},ve=k.memo(e=>{switch(e.type){case p.Pending:return t.jsx(E,{color:"#FFF5DB",c:"#FBC02E",size:"xs",radius:"lg",children:t.jsx(me,{size:12})});case p.Error:return t.jsx(E,{color:"#FEF3F2",c:"#FF4405",size:"xs",radius:"lg",children:t.jsx(J,{size:12})});case p.Success:return t.jsx(E,{color:"#ECFDF3",c:"#12B76A",size:"xs",radius:"lg",children:t.jsx($,{size:12})})}}),Ee=k.memo(e=>{M();const s=g.useStore();return t.jsxs(f,{justify:"space-between",align:"center",wrap:"nowrap",children:[t.jsxs(f,{gap:"xs",wrap:"nowrap",children:[t.jsxs(C,{pos:"relative",children:[t.jsx(H,{radius:"lg",size:"sm",src:e.schedule.channel.picture}),t.jsx(C,{pos:"absolute",w:12,h:12,bottom:-2,right:-2,children:R("social_network.icon.colorful","",e.schedule.channel.social_network)})]}),t.jsxs(S,{gap:4,children:[t.jsx(j,{size:"xs",fw:500,children:e.schedule.channel.name}),t.jsxs(f,{gap:4,wrap:"nowrap",children:[t.jsx(ve,{type:e.schedule.status}),t.jsx(j,{size:"xs",children:K.fromSeconds(e.schedule.send_time).setZone(Y).toFormat("dd.MM.yyyy, HH:mm")})]})]})]}),e.schedule.remote_post_link&&e.schedule.status!==p.Error&&e.schedule.status!==p.Pending&&t.jsx(z,{label:u("Go to post"),position:"top",children:t.jsx(N,{icon:q,onClick:()=>{window.open(e.schedule.remote_post_link,"_blank")}})}),e.schedule.status===p.Pending&&t.jsx(z,{label:u("Edit schedule"),position:"top",children:t.jsx(N,{icon:L,onClick:()=>{s.loadExisting({wpPostId:e.schedule.wp_post.id,scheduleGroupId:e.schedule.group_id})}})})]})}),Ie=k.memo(e=>{const s=M(),n=V(),[l]=i.useState(()=>g.createStore()),[r,d]=i.useState([]),[a,h]=i.useState(0),c=()=>{n.get("v1/schedules",{wp_post_id:e.wpPostId},o=>{d(o.schedules),h(o.total)})},x=()=>{l.loadEmpty({merge:{wpPostId:e.wpPostId,wpPostType:e.wpPostType,sync:!1}})},y=()=>{s.show(xe,{wpPostId:e.wpPostId})};return i.useEffect(()=>{c();const o=l.onSave$.subscribe(()=>{c()});return()=>o.unsubscribe()},[]),t.jsxs(g.Provider,{value:l,children:[t.jsx(D,{}),t.jsxs(S,{p:"sm",gap:"md",children:[t.jsxs(S,{gap:"lg",children:[!r.length&&t.jsx(f,{justify:"center",children:t.jsx(j,{c:"dimmed",size:"xs",children:u("No scheduled yet")})}),r.map(o=>t.jsx(Ee,{schedule:o},o.id)),a>10&&t.jsx(ee,{c:"#FB8A2E",size:"xs",onClick:y,children:u("See all")})]}),t.jsx(te,{}),t.jsx(f,{justify:"flex-end",children:t.jsx(se,{size:"xs",onClick:x,children:u("Schedule")})})]})]})}),Ce="fs-poster-iczTJMx",ze="fs-poster-aBPmwkG",Ae="fs-poster-4fzbI51",ke="fs-poster-3rbkXsI",Fe="fs-poster-O8dHgO1",w={channelPicture:Ce,storyAccount:ze,channel_name:Ae,channel__xs:ke,channel__sm:Fe},Be={size:"sm"},Te=e=>(e=v(v({},Be),e),t.jsxs(_,{className:ne(w.channel,w[`channel__${e.size}`]),direction:"column",gap:4,align:"center",children:[t.jsxs("div",{className:w.channelPicture,children:[(e.channel.channel_type==="account_story"||e.channel.channel_type==="ownpage_story")&&t.jsx(z,{label:u("For story scheduling"),children:t.jsx("div",{className:w.storyAccount,children:t.jsx(oe,{})})}),t.jsx(ae,{position:"bottom-end",color:"transparent",offset:4,label:R("social_network.icon.colorful","",e.channel.social_network),children:t.jsx(H,{radius:"xl",src:e.channel.picture,size:e.size==="xs"?32:"md",color:"#1570ef",children:e.channel.name[0].toUpperCase()})})]}),t.jsx("div",{className:w.channel_name,children:e.channel.name})]}));function G(){var e,s,n;return!!((n=(s=(e=window==null?void 0:window.wp)==null?void 0:e.data)==null?void 0:s.select)!=null&&n.call(s,"core/editor"))}const Ne=e=>{const[s]=i.useState(()=>g.createStore()),[n,l]=i.useState(!0),[r,d]=i.useState(),[a,h]=i.useState([]),c=()=>T(O,null,function*(){const[o,b]=yield Promise.all([I.get("v1/channels"),I.get("v1/metabox",{params:{wp_post_id:e.wpPostId}})]);d(b.data.auto_share),h(b.data.metabox_data.map(m=>o.data.channels.find(P=>P.id===+m.channel_id)).filter(m=>!!m))}),x=()=>{s.loadMetabox({wpPostId:e.wpPostId})},y=o=>{I.post("v1/metabox/auto-share-status",{wp_post_id:e.wpPostId,auto_share:o}).then(()=>c()).then(()=>d(o))};return i.useEffect(()=>{const o=s.onSave$.subscribe(()=>{c()});return c().finally(()=>l(!1)),()=>o.unsubscribe()},[]),i.useEffect(()=>{if(!G())return;let o={},b=window.wp.data.subscribe(()=>{let m=window.wp.data.select("core/editor").isSavingPost(),P=window.wp.data.select("core/editor").isAutosavingPost();m===!1&&o.isSavingPost&&!o.isAutosavingPost&&c(),o={isSavingPost:m,isAutosavingPost:P}});return()=>{b()}},[]),t.jsxs(g.Provider,{value:s,children:[t.jsx(D,{}),t.jsxs(C,{pos:"relative",children:[t.jsx(ce,{visible:n,zIndex:1e3}),t.jsxs(_,{direction:"column",gap:16,className:A.metabox,children:[t.jsx(_,{direction:"column",gap:2,children:t.jsx(re,{labelPosition:"left",checked:r,onChange:o=>y(o.currentTarget.checked),label:u("Auto-share this post")})}),r&&t.jsxs(t.Fragment,{children:[!a.length&&t.jsx(j,{size:"xs",fw:500,children:u("No channel selected, will not be shared anywhere.")}),t.jsx(_,{direction:"column",gap:12,children:t.jsx("div",{className:A.metabox__newChannels,children:a.map(o=>t.jsx(Te,{channel:o,size:"xs"},o.id))})}),t.jsx(_,{justify:"flex-end",children:t.jsx(ie,{size:"sm",leftIcon:L,onClick:x,children:u("Customize")})})]})]})]})]})},Me=e=>{i.useEffect(()=>{le.registerHookListener("content.default_selected_channels",d=>d.filter(a=>a.auto_share_on))},[]);const[s,n]=i.useState(e.wpPost.status);i.useEffect(()=>{if(!G())return;let d=window.wp.data.subscribe(()=>{const a=window.wp.data.select("core/editor").getEditedPostAttribute("status");typeof a=="string"&&a!==s&&n(a)});return()=>d()},[s]);const r=!["new","auto-draft","draft","pending","future"].includes(s)||e.wpPost.fspRunned||e.wpPost.type==="attachment";return t.jsx(S,{gap:16,className:A.container,children:r?t.jsx(Ie,{wpPostId:e.wpPost.id,wpPostType:e.wpPost.type}):t.jsx(Ne,{wpPostId:e.wpPost.id})})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("fs-poster-metabox");if(!e)return;const s=e.attachShadow({mode:"closed"});{const a=document.createElement("link");a.rel="stylesheet",a.href=window.FS_POSTER_STYLESHEET,s.appendChild(a)}const n=document.createElement("div");n.id="container",n.className=de.container,s.appendChild(n);const l=document.getElementById("fs-poster-portal");if(!l||!l.shadowRoot)return;const r=l.shadowRoot.getElementById("container");if(!r)return;const d={id:parseInt(e.getAttribute("data-post-id")),status:e.getAttribute("data-post-status"),type:e.getAttribute("data-post-type"),fspRunned:e.getAttribute("data-fsp-runned")==="true"};ue(n).render(t.jsx(he,{rootElm:n,portalTarget:r,children:t.jsx(Me,{wpPost:d})}))})});export default He();
