import{c as Se,j as e,G as g,b as B,aJ as ye,R as W,S as D,k as we,av as be,r as n,aw as Z,t as k,az as J,f as t,aA as ke,ab as V,ag as x,q as _e,v as q,aC as Ie,am as _,aR as f,F as Q,an as ve,aG as Be,B as De,m as Pe,E as I,e as S,g as v,aO as Ne,at as Ee,h as ze,as as Fe,a as Ae,aP as Te,aF as Me,D as Re,d as Le,ao as He,ac as z,ad as Oe,n as Ge}from"./global.module--4ihqMuE.js";var Ue=Se("file-export","IconFileExport",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M11.5 21h-4.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v5m-5 6h7m-3 -3l3 3l-3 3",key:"svg-1"}]]);const Ze="fs-poster-JkOr5EO",Je="fs-poster-CPBfzu0",Ve="fs-poster-WkBbvkt",qe="fs-poster-QTGY177",Qe="fs-poster-UQr6AJq",We="fs-poster-yKvfHeb",Ye="fs-poster-peUvBS5",Ke="fs-poster-LVSiZN1",$e="fs-poster-NpHhZuk",Xe="fs-poster-bxNgY8z",i={logsBody:Ze,channelCol:Je,dateCol:Ve,dateCol_date:qe,dateCol_time:Qe,sharedCol:We,statusCol_action:Ye,tooltip:Ke,actionCol:$e,labelStyle:Xe},A=l=>e.jsxs(g,{align:"center",justify:"space-between",h:42,style:{flexShrink:0},children:[e.jsxs(g,{gap:"xs",children:[e.jsx(B,{size:"xl",fw:500,children:l.title}),!!l.totalCount&&e.jsx(ye,{color:"#FDE272",c:"dark",variant:"filled",size:"lg",children:l.totalCount})]}),e.jsx(g,{gap:"xs",children:l.children})]});A.displayName="PageHeader";const T=l=>l.children;T.displayName="PageBody";const es=l=>{const o=W.Children.toArray(l.children);return e.jsxs(D,{h:"100%",gap:"xl",p:"lg",bg:"gray.0",style:{overflow:"hidden"},children:[o.find(c=>c.type.displayName===A.displayName),o.find(c=>c.type.displayName===T.displayName)]})},F=Object.assign(es,{Header:A,Body:T}),ss=l=>{const o=we(),c=He(),{dir:Y}=be(),[K,$]=n.useState([]),[X,ee]=n.useState([]),[se,M]=n.useState(!1),[te,le]=n.useState(!0),[r,ne]=n.useState([]),[d,ae]=n.useState([]),[oe,P]=n.useState(!1),[N,R]=n.useState(1),[y,ie]=n.useState(0),[m,ce]=n.useState(!1),[u,E]=n.useState([]),[w,re]=n.useState([]),[L,p]=n.useState(!1),[de,H]=Z(!1),[ue,O]=Z(!1),[G,he]=n.useState(),j=()=>{o.get("v1/schedules",{page:N,planner_id:l.plannerId,wp_post_id:l.wpPostId,statuses:d,social_networks:r},s=>{$(s.schedules),ie(s.total),le(!1)})},ge=s=>{M(!0),o.get("v1/schedules/insights",{id:s.id},a=>{ee(a.insights),M(!1)})};n.useEffect(()=>{j()},[N]),n.useEffect(()=>{R(1),j()},[r,d]);const pe=()=>{P(!0),o.get("v1/schedules/export",{planner_id:l.plannerId,wp_post_id:l.wpPostId,statuses:d,social_networks:r},s=>{const a=s.file,C=encodeURI(a),h=document.createElement("a");h.setAttribute("href",C),h.setAttribute("download",s.filename),document.body.appendChild(h),h.click(),h.remove(),P(!1)},()=>P(!1))},xe=s=>{o.post("v1/schedules/retry",{ids:[s.id]},a=>{c.info(t("This post will be shared soon")),j()})},b=Y==="ltr"?"left":"right",fe=s=>s.status==="success"?e.jsxs(g,{gap:"xs",children:[e.jsx(Ee,{size:"md",children:f[I.Success]}),e.jsx(S,{label:t("Go to post"),position:"top",children:e.jsx(v,{icon:ze,onClick:()=>{window.open(s.remote_post_link,"_blank")}})},"external_link")]}):s.status==="error"?e.jsxs(g,{gap:"xs",children:[e.jsx(Fe,{size:"md",rightSection:s.error_msg!==null&&e.jsx(S,{label:s.error_msg,position:"right",multiline:!0,w:256,children:e.jsx(Ae,{size:12})}),children:f[I.Error]}),s.channel.status&&e.jsx(S,{label:t("Retry"),children:e.jsx(v,{icon:Te,onClick:()=>{xe(s)}})})]}):e.jsx(Me,{size:"md",children:f[I.Pending]}),me=()=>{p(!0),o.delete("v1/schedules",{include_all:!1,include_ids:G?[G.id]:[]},s=>{p(!1),c.success(t("Log deleted successfully")),E([]),j()},()=>p(!1))},je=()=>{p(!0),o.delete("v1/schedules",m?{include_all:!0,exclude_ids:w,filters:{planner_id:l.plannerId,statuses:d,social_networks:r}}:{include_all:!1,include_ids:u},s=>{p(!1),c.success(u.length>1?t("{{count}} logs deleted successfully",{count:String(u.length)}):t("Log deleted successfully")),E([]),j()},()=>p(!1))},Ce=s=>{const a=Re.fromSeconds(s).setZone(Le),C=a.toFormat("dd.MM.yyyy"),h=a.toFormat("HH:mm");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:i.dateCol_date,children:C}),e.jsx("div",{className:i.dateCol_time,children:h})]})},U=n.useMemo(()=>k("social_networks",[]),[]);return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:t("Delete log(s)"),description:e.jsx(e.Fragment,{children:t("Are you sure you want to delete {{count}} log(s)?",{count:String(m?y-w.length:u.length)})}),labels:{confirm:t("Delete"),cancel:t("Cancel")},onConfirm:je,opened:de,onClose:H.close,loading:L},t("logs bulk delete")),e.jsx(J,{title:t("Delete log"),description:e.jsx(e.Fragment,{children:t("Are you sure you want to delete 1 log?")}),labels:{confirm:t("Delete"),cancel:t("Cancel")},onConfirm:me,opened:ue,onClose:O.close,loading:L},t("logs single delete")),e.jsxs(F,{children:[e.jsxs(F.Header,{title:t("Logs"),totalCount:y,children:[(m||u.length>0)&&e.jsx(ke,{size:"md",leftIcon:V,onClick:H.open,children:t("Delete ({{count}})",{count:String(m?y-w.length:u.length)})}),e.jsxs(x,{children:[e.jsx(x.Target,{children:e.jsx(_e,{size:12,color:"red",position:"top-end",withBorder:!0,disabled:!([...r,...d].length>0),children:e.jsx(q,{size:"md",leftIcon:Ie,children:t("Filter")})})}),e.jsx(x.Dropdown,{children:e.jsxs(D,{gap:16,children:[e.jsx(_,{label:t("Social networks"),placeholder:t("Select social networks"),value:r,onChange:s=>ne(s),tags:U.filter(s=>r.includes(s)).map(s=>e.jsx(_.Tag,{value:s,children:k("social_network.label","",s)},s)),optionRender:s=>e.jsx("span",{children:k("social_network.label","",s)}),options:s=>U,dropdownStyleProps:{miw:"max-content"},inputStyleProps:{w:320},searchable:!1}),e.jsx(_,{label:t("Statuses"),placeholder:t("Search status"),value:d,onChange:s=>ae(s),tags:d.map(s=>e.jsx(_.Tag,{value:s,children:s},s)),optionRender:s=>e.jsx("span",{children:f[s]}),options:s=>Object.keys(f).filter(a=>f[a].toLowerCase().includes(s.trim().toLowerCase())),dropdownStyleProps:{miw:"max-content"},inputStyleProps:{w:320}})]})})]}),e.jsx(q,{size:"md",leftIcon:Ue,onClick:pe,loading:oe,children:t("Export to CSV")})]}),e.jsx(F.Body,{children:e.jsx(Q,{direction:"column",className:i.logsBody,children:e.jsx(ve,{columns:[{align:b,className:i.channelCol,title:t("Channel"),render:s=>e.jsx(Be,{channel:s.channel})},{align:b,className:i.dateCol,title:t("Date & time"),render:s=>e.jsx("div",{children:Ce(s.send_time)})},{align:b,className:i.postCol,title:t("Shared post"),render:s=>e.jsx(De,{maw:250,children:e.jsx(Pe,{size:"xs",href:s.wp_post.link,target:"_blank",children:e.jsx(B,{lineClamp:2,fw:500,children:s.wp_post.title})})})},{align:b,className:i.statusCol,title:t("Status"),render:s=>fe(s)},{className:i.actionCol,align:"center",title:t("Actions"),render:s=>e.jsx(g,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:k("logs.table.actions",[s.status!==I.Error&&e.jsxs(x,{onOpen:()=>{ge(s)},children:[e.jsx(x.Target,{children:e.jsx(S,{label:t("Insights"),position:"top",children:e.jsx(v,{icon:Ne})},"insights")}),e.jsx(x.Dropdown,{children:e.jsx(D,{gap:8,children:se?e.jsx("div",{children:t("Loading...")}):X.map(a=>e.jsxs(Q,{justify:"space-between",gap:8,children:[e.jsxs(B,{fz:14,c:"#344054",children:[a.label,":"]}),e.jsx(B,{fz:14,fw:500,c:"#101828",children:a.value})]},a.label))})})]},"stats"),e.jsx(S,{label:t("Delete"),position:"top",children:e.jsx(v,{icon:V,onClick:()=>{he(s),O.open()}})},"delete")],s)})}],rows:K,pagination:{total:y,currentPage:N,onChange:R},selectable:{selectAllPages:m,includedIds:u,excludedIds:w,onChange:(s,a,C)=>{ce(s),E(a),re(C)}},loading:te})})})]})]})},ls=W.memo(l=>e.jsxs(z.Root,{opened:!0,onClose:l.onClose,centered:!0,size:"auto",children:[e.jsx(z.Overlay,{}),e.jsx(z.Content,{h:"100%",w:"100%",maw:1024,mah:560,children:e.jsxs(D,{w:"100%",h:"100%",gap:0,children:[e.jsx(g,{p:"xs",justify:"flex-end",children:e.jsx(Oe,{size:"lg",onClick:l.onClose})}),e.jsx(Ge,{}),e.jsx(ss,{plannerId:l.plannerId,wpPostId:l.wpPostId})]})})]}));export{Ue as I,F as P,ls as S};
